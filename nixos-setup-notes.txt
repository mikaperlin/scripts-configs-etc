# add package channels
sudo nix-channel --add https://nixos.org/channels/nixos-22.11 nixos
sudo nix-channel --add https://nixos.org/channels/nixos-unstable nixos-unstable
sudo nix-channel --add https://github.com/NixOS/nixos-hardware/archive/master.tar.gz nixos-hardware
sudo nix-channel --add https://github.com/nix-community/home-manager/archive/release-22.11.tar.gz home-manager
sudo nix-channel --update

# as user (no sudo/root)
nix-channel --add https://github.com/nix-community/home-manager/archive/release-22.11.tar.gz home-manager
nix-channel --update

# copy over main config files
sudo cp ~/nix/configuration.nix /etc/nixos
sudo cp ~/nix/sway-fixes.nix /etc/nixos
mkdir -p ~/.config/nixpkgs
ln -s ~/home/nix/home.nix ~/.config/nixpkgs/home.nix

# set up nixos!
sudo nixos-rebuild switch

# note: it *may* be necessary to run
# nix-shell '<home-manager>' -A install

# to disable ctrl+q in firefox, go to 'about:config' and enable 'browser.quitShortcut.disabled'
# to enable screen sharing in Teams as a chrome app, enable WebRPC PipeWire support:
#   chrome://flags/#enable-webrtc-pipewire-capturer

##################################################
# conda / python

conda-shell
conda-install
conda update conda
conda install python=3.10

# to set up a virual environment:
conda create --name <VENV-NAME> python=3.<VERSION>

# for jupyter notebooks
# NOTE: 'jupyter notebook' must be executed OUTSIDE virtual environments
#       venvs in notebooks are controlled by the choice of kernel
conda install -c conda-forge jupyterlab
conda install -c conda-forge nb_conda_kernels
conda install -c conda-forge jupyter_contrib_nbextensions  # optional extensions

# inside virtual environment for which we want a jupyter kernel:
conda install ipykernel

# WARNING: some package installations may fail due to dependencies external to python.
# In this case, these packages should be installed after calling 'conda-shell'.

# To enable activating virtual environments, call 'conda init',
#   which requires '~/."$SHELL"rc' to be writable.
# In practice, I prefer inspecting how 'conda init' modifies '~/."$SHELL"rc'
#   and enabling virtual environments 'manually'.

##################################################
# mathematica
# procedure inspired by https://gist.github.com/kinnala/b45c0ce0b2670be6cdaffb9b6e9ec6f3
# do everything in the ~/.mathematica directory

# aquire mathematica installer file, run
nix-store --add-fixed sha256 <FILE>

# download files here to a local directory:
# https://github.com/NixOS/nixpkgs/tree/master/pkgs/applications/science/math/mathematica

# get installer file hash, and update the hash in 'versions.nix', if necessary
nix --extra-experimental-features nix-command hash file <FILE>

# install mathematica!
nix-build default.nix

# executable will be in ~/.mathematica/result/...
