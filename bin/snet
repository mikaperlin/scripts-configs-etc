#!/usr/bin/zsh

service(){
  for i in ${*:2}; do
    stat=$(systemctl is-active $i)
    if [ $1 = down ]; then
      echo "disabling $i"
      sudo systemctl stop $i
      sudo systemctl disable $i
    elif [ $1 = up ]; then
      echo "enabling $i"
      sudo systemctl start $i
      sudo systemctl enable $i
    fi
  done
}

get_pid(){
  ps aux | grep $1 | grep -v grep | awk '{print $2}'
}

if ! [ $1 ]; then

  exit 0

elif [ $1 = wicd ]; then

  service down NetworkManager wpa_supplicant
  service up wicd

  if [ $(get_pid nm-applet) ]; then
    killall nm-applet 2>/dev/null &
  fi
  if ! [ $(get_pid wicd-client) ]; then
    wicd-client -t >/dev/null 2>/dev/null &
  fi

elif [ $1 = nm ]; then

  service down wicd
  service up NetworkManager wpa_supplicant

  for i in wicd-client wicd-daemon wicd/daemon/monitor.py; do
    pid=$(get_pid $i)
    if [ $pid ]; then
      sudo kill $pid
    fi
  done
  if ! [ $(get_pid nm-applet) ]; then
    nm-applet 2>/dev/null &
  fi

fi
