#!/bin/zsh

if ! [ $1 ]; then
  echo "no arguments given"
  exit 1
fi

wireless_interface=wlp3s0

home_dir=/home/perlinm
research_dir=$home_dir/Workspace/research

vpn_split=$home_dir/.osu-split-tunnel.conf
vpn_full=$home_dir/.osu-full-tunnel.conf

vpn_up=
if [ $(pidof vpnc) ]; then
  vpn_up=on
fi

osu_up=
if [ "$(iwconfig $wireless_interface | grep ESSID | grep OSU)" ] \
    || [ $vpn_up ]; then
  osu_up=on
fi

if [ $1 = down ]; then
  if [ $vpn_up ]; then
    sudo kill $(pidof vpnc)
  fi

elif [ $1 = status ]; then
  if [ $osu_up ]; then
    echo "OSU network or VPN up"
  else
    echo "OSU network and VPN down"
  fi

elif [ $1 = osu ]; then
  if ! [ $osu_up ]; then
    if ! [ $2 ]; then
      echo "Putting up OSU VPN (split tunnel)"
      sudo vpnc $vpn_split
    else
      echo "Putting up OSU VPN (full tunnel)"
      sudo vpnc $vpn_full
    fi
  fi

elif [ $1 = "mox" ]; then
  if ! [ $osu_up ]; then
    $0 status
    $0 osu
  fi

  remote_addr=perlinm@rogue.ne.oregonstate.edu
  mox_dir=mox

  if [ -z $2 ]; then
    ssh $remote_addr
  else
    if [ $2 = up ]; then
      src=$research_dir/
      dest=$remote_addr:
    elif [ $2 = down ]; then
      src=$remote_addr:
      dest=$research_dir/
    else
      echo "usage: tn mox [up/down]"
      exit 1
    fi
    rsync -ulrvt -e ssh $src$mox_dir $dest
  fi

elif [ $1 = deft ]; then

  remote_addr=perlinm@quipu.physics.oregonstate.edu
  sw_mc_dir=deft/src/Monte-Carlo
  deft_dir=deft

  if [ -z $2 ]; then
    ssh $remote_addr
  else
    if [ $2 = up ]; then
      src=$research_dir/
      dest=$remote_addr:
    elif [ $2 = down ]; then
      src=$remote_addr:
      dest=$research_dir/
    else
      echo "usage: tn deft [up/down]"
      exit 1
    fi
    rsync -ulrvt -e ssh $src$deft/papers/square-well-liquid $dest/papers/
    rsync -ulrvt -e ssh $src$deft/src/Monte-Carlo $dest/src/
  fi

elif [ $1 = paho ]; then
  ssh paholg.com

elif [ $1 = onid ]; then
  ssh shell.onid.oregonstate.edu

elif [ $1 = nasa ]; then
  ssh jumpgate

else
  echo "no valid command given"
fi
