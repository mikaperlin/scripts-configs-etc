#!/usr/bin/env python3
import sys, os, shutil, subprocess

trash_dir = os.path.expanduser('/home/perlinm/.trash')
old_ext = '.old'

def backup(item):
  if not os.path.exists(item+old_ext):
    os.rename(item,item+old_ext)
  else:
    backup(item+old_ext)

for item in sys.argv[1:]:
  item_path = os.path.abspath(item)
  item_dest = trash_dir + item_path
  if not os.path.exists(os.path.dirname(item_dest)):
    os.makedirs(os.path.dirname(item_dest))
  try:
    while os.path.exists(item_dest):
      backup(item_dest)
    os.rename(item_path,item_dest)
  except PermissionError:
    print("invoke with sudo (permission error)")
  except Exception as ex:
    print(ex)
