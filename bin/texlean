#!/usr/bin/python2
import sys, os, fnmatch, subprocess

tags = [ '*.aux', '*.log', '*.tex.backup', '*_region_.tex',
         '*.synctex.gz', '*.blg','*.bbl', '*.nav', '*.dvi', '*.lof',
         '*.toc', '*.lop', '*.el', '#*#', '.#*', '*~', '*.swp', '*.pyc',
         '*.cpt', '*.bcf', '*.run.xml', '*.emacs.d/auto-save-list*']

emptyFileTags = [ '*.out', '*.snm' ]

excludes = [ '/deft/', '/.emacs.d/', '/.tmp/', '/ltpda' ]

bannedDirs = [ '/home/perlinm' ]

force_flag = '--force'

def rem(root,item):
  path = os.path.abspath(os.path.join(root,item))
  remove = True
  for exclude in excludes:
    if exclude in path:
      remove = False
  if remove:
    print path
    subprocess.call(['rem',path])

def clean(dir):
  if os.path.abspath(dir) in bannedDirs:
    print 'Directory banned from cleaning:',dir
    exit(-1)
  for root, dirs, files in os.walk(dir):
    for tag in tags:
      for file in fnmatch.filter(files,tag):
        rem(root,file)
    for tag in emptyFileTags:
      for file in fnmatch.filter(files,tag):
        if os.path.getsize(os.path.join(root,file)) == 0:
          rem(root,file)
    for dir in dirs:
      if dir == 'auto':
        rem(root,dir)

if len(sys.argv) == 1:
  clean(os.getcwd())
else:
  args = sys.argv[1:]
  if force_flag in args:
    args.remove(force_flag)
  for arg in args:
    clean(arg)
